<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-body">
    <h3 id="myModalLabel">Let's start a new deal</h3>
    <p>Select your background image:</p>
        <%= s3_uploader_form post: images_url, as: "image[image_url]" do %>
          <%= file_field_tag :file, multiple: true %>
        <% end %>
    <script id="template-upload" type="text/x-tmpl">
      <div class="upload">
        {%=o.name%}
        <div class="progress"><div class="bar" style="width: 0%"></div></div>
      </div>
    </script>
    </p>
    <% if @images.any? %>
      <p>Or use a picture you've already uploaded:</p>
    <% else %>
      <p>Don't have a great pic? No worries. Use one of ours.</p>
    <% end %>
    <ul class="images_to_select">
      <% if @images.any? %>
        <% @images.each do |image| %>
          <li>
            <%= image_tag image.image_url, id: "bg_image_#{image.id}" %>
            <p><%= link_to 'Preview', '#', class: 'preview' %> | <%= link_to 'Select', '#', class: 'select' %></p>
          </li>
        <% end %>
        <p>Don't have a great pic? No worries. Use one of ours.</p>
        <li>
          <%= image_tag 'bg_bar2.jpg', id: 'bg_image_1' %>
          <p><%= link_to 'Preview', '#', class: 'preview' %> | <%= link_to 'Select', '#', class: 'select' %></p>
        </li>
      <% else %>
        <li>
          <%= image_tag 'bg_bar2.jpg', id: 'bg_image_1' %>
          <p><%= link_to 'Preview', '#', class: 'preview' %> | <%= link_to 'Select', '#', class: 'select' %></p>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<div class="deal_container hide">
	<div class="deal_inner">
    <h1><%= current_authorized_user.business_name %></h1>
    <%= render 'form' %>
	</div>
</div>

<script>

  $(function(){

    $('#myModal').modal({
      backdrop: 'static',
      keyboard: true
    });

    $('#myModal').modal('show');
    $("#deal_end_date").datepicker({ dateFormat: 'yy-mm-dd', constrainInput: true, minDate: new Date() });

    $('.preview').click(function(){
      $('.backstretch').remove();
      var url = $(this).parent().parent().children(':first-child').attr('src');
      $.backstretch(url);
      return false;
    });

    $('.select').click(function(){
      $('.backstretch').remove();
      var url = $(this).parent().parent().children(':first-child').attr('src');
      var image_id = $(this).parent().parent().children(':first-child').attr('id').toString().match(/\d+/)[0];
      $.backstretch(url);
      $('#myModal').modal('hide');
      $('.deal_container').delay(1000).slideDown('slow');
      $('#deal_image_id').val(image_id);
      return false;
    });

  });

</script>