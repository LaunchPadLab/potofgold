<div class="background_image_form_container">
  <p>Want to change this background image? Click <%= link_to 'here', '', id: 'background_image_link' %></p>
  <div id="background_image_form" class="hide">
    <%= render 'background' %>
  </div>
</div>
<div class="deal_container">
	<div class="deal_inner">
    <h1><%= current_authorized_user.business_name %></h1>
    <%= render 'form' %>
	</div>
</div>

<script>
  
  $(function(){

    $.backstretch("<%= @deal.image.image_url %>");
    $("#deal_end_date").datepicker({ dateFormat: 'yy-mm-dd', constrainInput: true, minDate: new Date(), defaultDate: '<%= @deal.end_date.strftime("%Y-%-m-%-e") %>' });
    
    $('#background_image_link').click(function(){
      $('#background_image_form').slideDown();
      return false;
    });

    $('.preview').click(function(){
        $('.backstretch').remove();
        var url = $(this).parent().parent().children(':first-child').attr('src');
        $.backstretch(url);
        return false;
    });

    $('.select').click(function(){
      $('.backstretch').remove();
      var url = $(this).parent().parent().children(':first-child').attr('src');
      var image_id = $(this).parent().parent().children(':first-child').attr('id').toString().match(/\d+/)[0];
      $.backstretch(url);
      $('#background_image_form').slideUp();
      $('.background_image_form_container').slideDown();
      $('#deal_image_id').val(image_id);
      return false;
    });

  });
  
</script>